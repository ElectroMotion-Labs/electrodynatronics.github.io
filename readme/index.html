<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>readme | <title> GeeksforGeeks icon </title> <img src="/assets/img/KTH_Royal_Institute_of_Technology_logo.svg.png" title="Electrodynatronics" height="500"> </title> <meta name="author" content="You R. Name"> <meta name="description" content="Materials for courses you taught. Replace this text with your description."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/KTH_Royal_Institute_of_Technology_logo.svg.png"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://electrodynatronics.github.io/readme/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><title> GeeksforGeeks icon </title> <img src="/assets/img/KTH_Royal_Institute_of_Technology_logo.svg.png" title="Electrodynatronics" height="500"></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item active"> <a class="nav-link" href="/readme/">readme<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/projects/">projects</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">readme</h1> <p class="post-description">Materials for courses you taught. Replace this text with your description.</p> </header> <article> <h1 id="honda-haru-motor-module-control-program-c-and-python-external-version">HONDA HARU Motor Module Control Program C++ and Python (External Version)</h1> <ul> <li><a href="#introduction">Introduction</a></li> <li><a href="#test-machine-details">Test Machine Details</a></li> <li><a href="#initial-steps">Initial Steps</a></li> <li> <a href="#running-the-programs">Running the Programs</a> <ul> <li><a href="#basic-setup">Basic Setup</a></li> <li><a href="#testing-the-motors">Testing the motors</a></li> <li><a href="#runing-the-joystick-program">Runing the Joystick Program</a></li> </ul> </li> <li><a href="#structure-of-the-main-program">Structure of the Main Program</a></li> <li><a href="#providing-custom-inputs-without-the-gamepad">Providing Custom Inputs Without the Gamepad</a></li> <li><a href="#time-profiling-of-the-program-with-the-current-hardware-and-software">Time Profiling of the Program With the Current Hardware and Software</a></li> </ul> <h2 id="introduction">Introduction</h2> <p>This program has been developed to control the KTH neck module of the Honda HARU. The details of the test machine and on running the program are given below.</p> <h2 id="test-machine-details">Test Machine Details</h2> <ol> <li> <strong>Processor</strong>: Intel Core i5-4300 CPU @ 1.90 GHz (2.50 GHz Peak)</li> <li> <strong>RAM</strong>: DDR3 16.0 GB</li> <li> <strong>Disk space</strong>: 80.12 GB</li> <li> <strong>OS</strong>: Ubuntu 22.04 full (normal) installation</li> <li> <strong>C++ version</strong>: 11.3.0</li> <li> <strong>Python version</strong>: 3.10.6</li> </ol> <h2 id="initial-steps">Initial Steps</h2> <ol> <li>Run the following code <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> sudo apt-get update
 sudo apt-get upgrade
</code></pre></div> </div> </li> <li>Download and install Dynamixel Wizard following instructions given on the Robotis website <a href="https://emanual.robotis.com/docs/en/software/dynamixel/dynamixel_wizard2/#install-linux" rel="external nofollow noopener" target="_blank">(installations and download link)</a> </li> <li>Download the Dynamixel SDK from the Robotis website <a href="https://github.com/ROBOTIS-GIT/DynamixelSDK/archive/refs/heads/master.zip" rel="external nofollow noopener" target="_blank">(download link)</a> </li> <li>Unzip the downloaded Dynamixel SDK into a folder of your choice</li> <li>Follow the installation instructions for the Dynamixel SDK corresponding to C++ Linux <a href="https://emanual.robotis.com/docs/en/software/dynamixel/dynamixel_sdk/library_setup/cpp_linux/#cpp-linux" rel="external nofollow noopener" target="_blank">(installation instructions)</a> </li> <li>IMPORTANT!! Before running the test program disconnect the motor from any mechanical assemblies!!! (the motor with ID 1 needs to be free to rotate for the default example)</li> <li>Additionally, change the buadrate and dynamixel ID in the <code class="language-plaintext highlighter-rouge">.cpp</code> file before running the test program. You might also have to also edit the control table addresses depending on the motor</li> <li>If you would like to use an Xbox 360 controller, follow the instructions given on this page, <a href="https://askubuntu.com/questions/14849/how-to-use-xbox-360-wireless-gaming-controller" rel="external nofollow noopener" target="_blank">link</a> </li> <li> <ol> <li>To, check if the Xbox controller works, run <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> sudo apt-get update
 sudo apt-get install jstest-gtk
</code></pre></div> </div> </li> </ol> </li> <li>Install the latest version of Python 3</li> <li>Install the setserial module, by running <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>sudo apt-get install setserial
</code></pre></div> </div> </li> <li>Install Gnome Terminal to run multiple parallel instances of terminal <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>sudo apt-get install gnome-terminal
</code></pre></div> </div> </li> </ol> <h2 id="running-the-programs">Running the Programs</h2> <h3 id="basic-setup">Basic Setup</h3> <ol> <li>Download this program as a .zip file and extract it into a folder of your choice</li> <li>Ensure that the IDs of your motors are set according to the figure given below and change the baud rate for the motors to 4000000 (4M) on Dynamixel Wizard <img src="Images/motor_ids.jpg" alt=""> </li> </ol> <h3 id="testing-the-motors">Testing the motors</h3> <ol> <li>Ensure that the motor IDs and baud rates match the figure above</li> <li>Ensure that the port is correctly set in this file (#define DEVICENAME)</li> <li>Disconenct the motors from all loads (wire ropes included)</li> <li>Set all motors to a set poisition of 0 on the dynamixel wizard</li> <li>Check if all motors are rotating synchronously</li> <li>To terminate, hit Ctrl+C on terminal</li> </ol> <h3 id="runing-the-joystick-program">Runing the Joystick Program</h3> <ol> <li>Connect an Xbox 360 controller</li> <li>Run <code class="language-plaintext highlighter-rouge">jstest-gtk</code> from the menu and test the controller</li> <li>Note: The following programs work only on AMD64 architecture and a 64bit OS and assumes that the motors and U2D2 are connected on <code class="language-plaintext highlighter-rouge">/dev/ttyUSB0</code> </li> <li>Navigate to program folder of your choice, for example <code class="language-plaintext highlighter-rouge">[KTH HARU C++ Directory]/Programs/HARU Program Sync Read Write</code> </li> <li>Open terminal in this folder</li> <li>Run the bash script to run the test program <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> ./run_haru_sync_read_write.sh
</code></pre></div> </div> </li> <li>The script will spawn a new terminal window and request the root password</li> <li>The robot can now be controlled using the right joystick of the gamepad</li> <li>Incase of any errors, disconnect and reconnect the gamepad and all connected USB devices</li> <li>Repeat the instructions from the start</li> </ol> <h2 id="structure-of-the-main-program">Structure of the Main Program</h2> <ol> <li>The program consists of 3 parts, the wrapper bash script, the C++ program to communicate with the motors, and the Python program to read from the gamepad</li> <li>The bash script provides a wrapper to concurrently execute the phython and C++ programs</li> <li>A short overview of the bash script <ul> <li>The bash script executes the Python program on a seperate termial instance with root previlages</li> <li>Next, the script sets the latency timer of <code class="language-plaintext highlighter-rouge">/dev/ttyUSB0</code> to 1ms (this is the minimum value)</li> <li>The bash sript then compiles the C++ program and runs it on the current terminal instance</li> </ul> </li> <li>The Python program communicates with the C++ program through a memory mapped file</li> </ol> <h2 id="providing-custom-inputs-without-the-gamepad">Providing Custom Inputs Without the Gamepad</h2> <ol> <li>In order to provide custom inputs to the program without using a gamepad, the memory mapped file has to be updated by a feedeer program</li> <li>The memory mapped file is a binary file named <code class="language-plaintext highlighter-rouge">data_exchange_file.bin</code> and contains two IEEE 754 float values expressed as binary values</li> <li>The first float value refers to roll movement of the robot expressed in the range [-1, +1], the second float value refers to the pitch movement expressed in the range [-1, +1]</li> <li>In order to provide inputs to this memory mapped file, you will need to create a program that accesses the memory mapped file with write previlages</li> </ol> <h2 id="time-profiling-of-the-program-with-the-current-hardware-and-software">Time Profiling of the Program With the Current Hardware and Software</h2> <ol> <li>Note: The program works as intended only whe the USB latency is set to 1ms. The default is 16ms, and this slows the communication to a large extent.</li> <li>To check if the USB latency, run, <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> cat /sys/bus/usb-serial/devices/ttyUSB0/latency_timer
</code></pre></div> </div> </li> <li>HARU Program With Classic Read Write (1 write and 1 read each for 4 motors): best case execution time approximately 10ms</li> <li>HARU Program With Sync Read Write (1 write and 5 reads each for 4 motors): best case execution time approximately 6ms</li> <li>The times are approximate and can sometimes take longer if the OS doesn’t allocate processor time accordingly</li> </ol> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 You R. Name. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>